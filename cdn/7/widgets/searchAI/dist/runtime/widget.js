System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-core/react","jimu-theme"],(function(e,t){var o={},n={},r={},i={},l={},s={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JSAPILayerTypes=e.JSAPILayerTypes,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.moduleLoader=e.moduleLoader,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){r.Alert=e.Alert,r.Button=e.Button,r.Checkbox=e.Checkbox,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.Icon=e.Icon,r.Link=e.Link,r.Loading=e.Loading,r.LoadingType=e.LoadingType,r.Popper=e.Popper,r.TextInput=e.TextInput,r.defaultMessages=e.defaultMessages},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){l.forwardRef=e.forwardRef,l.useImperativeHandle=e.useImperativeHandle},function(e){s.useTheme=e.useTheme}],execute:function(){e((()=>{var e={44:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},64:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},210:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A46 46 0 0 1 8 14.492a48 48 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},244:e=>{"use strict";e.exports=o},321:e=>{"use strict";e.exports=r},496:e=>{"use strict";e.exports=n},655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},686:e=>{"use strict";e.exports=i},888:e=>{"use strict";e.exports=s},972:e=>{"use strict";e.exports=l},996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var u={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(u),a.d(u,{__set_webpack_public_path__:()=>Ht,default:()=>Bt});var e=a(244),t=a(496);const o=[0,3],n={wkid:4326};var r,i,l,s,c,d;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(r||(r={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(i||(i={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(l||(l={})),function(e){e.Classic="Classic",e.Compact="Compact"}(s||(s={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(c||(c={})),function(e){e.CustomSearchSources="CustomSearchSources",e.MapCentric="MapCentric"}(d||(d={}));var v=a(321);const g={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistory:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var p=a(655),m=a.n(p),h=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const f=t=>{const o=window.SVG,{className:n}=t,r=h(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:m()},r)):e.React.createElement("svg",Object.assign({className:i},r))};var S=a(64),y=a.n(S),b=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const I=t=>{const o=window.SVG,{className:n}=t,r=b(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:y()},r)):e.React.createElement("svg",Object.assign({className:i},r))};var x=a(686);const w="address";var C=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const j=e=>C(void 0,void 0,void 0,(function*(){const t=M(e),o={shouldConvertSR:!1,searchText:e};if(!t)return Promise.resolve(o);const n=yield R(e),r=yield function(e){return C(this,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/coordinateFormatter","esri/geometry/SpatialReference"]).then((t=>{const[o,n]=t;if(o.load(),o.isSupported()){if(o.isLoaded()){const t=o.fromUtm(e,new n({wkid:4326}),"latitude-band-indicators");return t&&(null==t?void 0:t.x)&&(null==t?void 0:t.y)?Promise.resolve(!0):Promise.resolve(!1)}return Promise.resolve(!1)}return Promise.resolve(!0)}))}))}(e);return n?function(e){return C(this,void 0,void 0,(function*(){let t=e;return(0,x.loadArcGISJSAPIModules)(["esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/geometry/support/webMercatorUtils","esri/rest/geometryService"]).then((o=>{const[n,r,i,l]=o,s=new n({wkid:4326});if(s&&e){if(s.equals(e.spatialReference))return Promise.resolve(t);if(s.isWebMercator&&e.spatialReference.equals(s))return t=i.geographicToWebMercator(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);if(s.equals(s)&&e.spatialReference.isWebMercator)return t=i.webMercatorToGeographic(e),t.isSinglePoint=e.isSinglePoint,Promise.resolve(t);{const o=k();if(o){const n=new r;return n.geometries=[e],n.outSpatialReference=s,n.f="json",l.project(o,n).then((o=>(t=o&&o.length>0&&o[0],t?(t.isSinglePoint=e.isSinglePoint,Promise.resolve(t)):Promise.resolve(t))),(e=>Promise.reject(new Error(e))))}return Promise.resolve(t)}}return Promise.resolve(null)}))}))}(n).then((t=>{const o=T(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})}),(e=>Promise.resolve(o))):r?function(e){return C(this,void 0,void 0,(function*(){const t=k();return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/request"]).then((o=>{const[n,r,i]=o;let l=null;const s={query:{sr:4326,conversionType:"UTM",conversionMode:"utmDefault",strings:[e],f:"json"},responseType:"json"};if(!t)return Promise.resolve(l);i(`${t}/fromGeoCoordinateString`,s).then((e=>{const t=Number(e[0][0]),o=Number(e[0][1]);return isNaN(t)||isNaN(o)||(l=new n(t,o,new r({wkid:4326}))),Promise.resolve(l)}))}))}))}(e).then((t=>{const o=T(t);return Promise.resolve({shouldConvertSR:!!o,searchText:o||e,locationPoint:t})})):Promise.resolve(o)}));function M(e){return e&&L(e)}const R=t=>C(void 0,void 0,void 0,(function*(){return(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((o=>{const[n,r]=o;return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{const{isValidWkid:o}=e;let i=null;if(!t)return i;const l=t.split(":"),s=l[0],a=Number(l[1]);if(a&&o(a)&&s){const e=s.split(","),t=Number(e[0]),o=Number(e[1]);isNaN(t)||isNaN(o)||(i=new n(t,o,new r({wkid:a})))}return Promise.resolve(i)}))}))}));function T(e){let t=null;return!e||isNaN(e.x)||isNaN(e.y)||(t="Y:"+e.y+",X:"+e.x),t}function k(){var t,o;const n=(0,e.getAppStore)().getState();return(null===(o=((null===(t=null==n?void 0:n.portalSelf)||void 0===t?void 0:t.helperServices)||{}).geometry)||void 0===o?void 0:o.url)||null}const L=e=>null==e?void 0:e.includes(",");var P=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const E={alias:"ADDRESS",type:"string",name:w},N=(Object.assign(Object.assign({},E),{jimuName:w}),(e,t,o,n)=>ue(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?O(t,e,o,n):Promise.resolve({})),O=(e,t,o,n)=>{var r;const i={geocodeURL:null==e?void 0:e.geocodeURL,address:t,maxSuggestion:null==e?void 0:e.maxSuggestions,utilityId:null===(r=null==e?void 0:e.useUtility)||void 0===r?void 0:r.utilityId,countryCode:null==e?void 0:e.countryCode,extent:o,enableLocalSearch:null==e?void 0:e.enableLocalSearch,minScale:null==e?void 0:e.minScale,jimuMapView:n};return U(i).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,r)=>{const i=o.text;if(i&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,i)){const r={suggestionHtml:se(i,t),suggestion:i,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(r)}})),n=oe(n,"suggestion");const r={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(r)})).catch((e=>Promise.reject(new Error(e))))},D=t=>{const{address:o,maxResultNumber:n,geocodeItem:r,searchResultView:i,extent:l,jimuMapView:s,id:a}=t;if(!ue(null==r?void 0:r.outputDataSourceId))return;return ae(te(r.outputDataSourceId),e.DataSourceStatus.NotReady),A({address:o,maxResultNumber:n,searchResultView:i,geocodeItem:r,extent:l,jimuMapView:s,id:a})},A=t=>{const{address:o,maxResultNumber:n,geocodeItem:r,extent:i,jimuMapView:l,id:s}=t,{outputDataSourceId:a,singleLineFieldName:u,defaultAddressFieldName:c,enableLocalSearch:d}=r,v=te(a),g={geocodeItem:r,address:o,maxResultNumber:n,singleLineFieldName:u,addressFields:(null==r?void 0:r.addressFields)||[],countryCode:null==r?void 0:r.countryCode,extent:i,enableLocalSearch:d,jimuMapView:l};return F(g).then((t=>P(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))return Promise.resolve(!1);const n=null==t?void 0:t.filter((e=>null==e?void 0:e.address)),{extent:i,graphics:l}=function(e,t){let o;const n=(null==e?void 0:e.map(((e,n)=>{var r,i;const l=e.attributes;l.address=e.address,t&&(l[t]=e.address),l.objectid=n;const s=o?null==o?void 0:o.clone():o;o=s?null==s?void 0:s.union(null===(r=e.extent)||void 0===r?void 0:r.clone()):null===(i=e.extent)||void 0===i?void 0:i.clone();return{attributes:l,geometry:e.location}})))||[];return{graphics:n,extent:o}}(n,c),u=v,d=(null==r?void 0:r.label)||u.getLabel(),g=function(e,t){var o;if(!e||0===(null==e?void 0:e.length))return;const n={content:[{type:"fields",fieldInfos:e.map((e=>({fieldName:e.name,isEditable:!1,label:e.name,visible:!0})))},{type:"attachments",displayType:"auto"}],title:`${t}: {${null===(o=e[0])||void 0===o?void 0:o.name}}`};return n}(null==r?void 0:r.displayFields,d),p={id:`${a}_layer`,geometryType:"point",fullExtent:i};g&&(p.popupTemplate=g),yield u.setSourceFeatures(l,p);const m=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;ae(v,m);const h={where:"2=2",sqlExpression:null,pageSize:null==n?void 0:n.length,outFields:["*"],page:1,returnGeometry:!0};return u.load(h,{widgetId:s}).then((t=>{const o=u.getRecords();return o.forEach(((e,t)=>{o[t].__extent=n[t].extent})),Promise.resolve(e.DataSourceStatus.Unloaded)}))})))).catch((e=>Promise.reject(new Error(e))))};const F=t=>P(void 0,void 0,void 0,(function*(){const{geocodeItem:o,address:r,maxResultNumber:i,singleLineFieldName:l,addressFields:s,countryCode:a,extent:u,jimuMapView:c}=t,{geocodeURL:d,magicKey:v,useUtility:g,enableLocalSearch:p,minScale:m}=o,h=(null==o?void 0:o.spatialReference)||n,f=M(r);let S;return f&&(S=yield j(r)),(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((t=>{var o;const[n,y]=t,b=new y(h),I=l||"SingleLine";let x=(0,e.Immutable)({maxSuggestions:i});(null===(o=null==s?void 0:s.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(","))&&(x=x.set("outFields","*"));const w=f&&S.searchText?S.searchText:r;x=x.setIn([I],w),v&&(x=x.set("magicKey",v));const C={address:null==x?void 0:x.asMutable({deep:!0}),outSpatialReference:b};if(f&&S.locationPoint)C.location=S.locationPoint;else if(p){const e=B(p,m,c);e&&(C.location=e)}return a&&(C.countryCode=a),u&&(C.searchExtent=u.toJSON()),n.addressToLocations(d,C,{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>!!(null==e?void 0:e.location))),H(null==g?void 0:g.utilityId),e)),(e=>{console.error(e.message);const t=G(null==g?void 0:g.utilityId,e);return $(null==g?void 0:g.utilityId,e),t?e:[]}))}))})),U=e=>{const{geocodeURL:t,address:o,maxSuggestion:n,utilityId:r,countryCode:i,extent:l,enableLocalSearch:s,jimuMapView:a,minScale:u}=e;return(0,x.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((e=>{const[c]=e,d={text:o,maxSuggestions:n};i&&(d.countryCode=i),l&&(d.searchExtent=l.toJSON());const v=B(s,u,a);return v&&(d.location=v),c.suggestLocations(t,d).then((e=>(H(r),e||[])),(e=>{console.error(e.message);const t=G(r,e);return $(r,e),t?e:[]}))}))};function B(e,t,o){var n,r;if(!e||!o||!t)return;let i;const l=null===(n=o.view)||void 0===n?void 0:n.scale,s=null===(r=o.view)||void 0===r?void 0:r.center;return l<t&&s&&(i=s),i}function H(t){t&&e.UtilityManager.getInstance().reportUtilityState(t,!0)}function $(t,o){if(!t)return;const n=G(t,o),r=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,r):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function G(t,o){var n,r,i,l;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.httpStatus)&&(null===(l=null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.message)||void 0===l?void 0:l.includes("Item does not exist"))&&(a=!0),s||a}const V=(e,t,o,n=!1)=>{const r=null==e?void 0:e.outputDataSourceId,i=te(null==e?void 0:e.outputDataSourceId),l=null==i?void 0:i.getRecordsByPage(1,t);return Promise.resolve({records:l,configId:e.configId,dsId:r,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})},J=(e,...t)=>P(void 0,[e,...t],void 0,(function*(e,t=n){const o=e&&e.coords;return o?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{const[n,r]=e,i=new r(t);return new n({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:i})})):Promise.resolve(null)}));var W=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};function K(t,o,n,r,i){return W(this,void 0,void 0,(function*(){var l,s;if(!ue(null===(l=null==n?void 0:n.useDataSource)||void 0===l?void 0:l.dataSourceId))return Promise.resolve({});const a=(null==n?void 0:n.searchFields)||[],u=null===(s=null==r?void 0:r.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===s?void 0:s[0];return function(t,o,n,r,i,l){return W(this,void 0,void 0,(function*(){var s;const{label:a,icon:u,configId:c}=n,d=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,v=te(d),g={searchText:t,searchFields:r.map((e=>e.name)),dataSource:v,maxSuggestions:i,extent:l};return e.dataSourceUtils.querySuggestions(g).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:c,isFromSuggestion:!0}))),layer:a,icon:u};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,u,a,null==o?void 0:o.maxSuggestions,i)}))}function _(t,o,n,r){const i=o.map((e=>e.jimuName));return e.dataSourceUtils.getSQL(t,i,n,r)}function q(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],r=(null==t?void 0:t.map((e=>e.jimuName)))||[],i=te(o),l=(null==i?void 0:i.getAllUsedFields())||[];return"*"===l?"*":Array.from(new Set(n.concat(r).concat(l)))}const z=(t,o,n)=>{var r;const i=null===(r=null==t?void 0:t.useDataSource)||void 0===r?void 0:r.dataSourceId,l=ce(t.configId,n);if(!ue(i,l))return Promise.resolve({});const s=te(i,l),a=e.DataSourceManager.getInstance().getLocalDataSourceId(i,l),u=(null==s?void 0:s.getRecordsByPage)&&(null==s?void 0:s.getRecordsByPage(1,o));return Promise.resolve({records:u,configId:t.configId,dsId:i,localDsId:a,isGeocodeRecords:!1})};var Q=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const Y=(e,t,o)=>{var n;let r;return e===d.MapCentric&&t&&o&&(r=null===(n=o.view)||void 0===n?void 0:n.extent),r};function X(t){var o,n;const{serviceList:i,searchText:l,id:s}=t,a={};for(const e in i){const t=i[e],{searchServiceType:l,useDataSource:s}=t;if(l===r.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let r=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,i=(null===(n=a[e])||void 0===n?void 0:n.outFields)||[];const l=q(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&r.push(null==t?void 0:t.SQL),i=Array.from(new Set(i.concat(l)))):(r=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,i=l,a[e]={}),a[e].sqlExpression=r,a[e].outFields=i}}!function(t,o,n){var r,i;for(const l in null==t?void 0:t.asMutable({deep:!0})){const s=null===(r=null==t?void 0:t[l])||void 0===r?void 0:r.sqlExpression,a=null===(i=null==t?void 0:t[l])||void 0===i?void 0:i.outFields,u=te(l);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,l)}const Z=(e,t,o,n)=>{var r;const i=null===(r=null==e?void 0:e.useDataSource)||void 0===r?void 0:r.dataSourceId,l=ce(o,t),s=te(i),a=te(i,l);a&&(null==a?void 0:a.updateQueryParams)&&(a&&a.updateQueryParams({},l),n&&s&&s.updateQueryParams({},t))},ee=(e,t,o,n=!1)=>{const i=[];for(const l in e){const s=e[l];let a;a=s.searchServiceType===r.FeatureService?z(s,t,o):V(s,t,0,n),i.push(a)}return Promise.all(i)},te=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),r=n.getLocalDataSourceId(t,o);return n.getDataSource(r)}return e.DataSourceManager.getInstance().getDataSource(t)},oe=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const r=e[n];let i=!1;for(let e=0;e<o.length;e++)if(r[t]===o[e][t]){i=!0;break}i||o.push(r)}return o},ne=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=re(o,t);let r=e.utils.readLocalStorage(n);r&&(r=unescape(r));return r?null==r?void 0:r.split("/@/"):[]},re=(e,t)=>`exb-${e}-${t}_recent_searches`,ie=(e,t)=>{var o;return null===(o=null==e?void 0:e.filter((e=>e.configId===t)))||void 0===o?void 0:o[0]},le=e=>{let t=0;for(const o in e)t++;return t};function se(t,o){if(!o)return t;const n=e.dataSourceUtils.getRegOfSearchText(o);return t.match(n)?t.replace(n,"<strong >$1</strong>"):t}function ae(e,t){null==e||e.setStatus(t),null==e||e.setCountStatus(t)}function ue(e,t){return!!e&&!!te(e,t)}const ce=(e,t)=>`${t}_${e}_useDataSource`,de=(t,o)=>{var n;let i=!0;for(const l in t){const s=t[l];let a;if(s.searchServiceType===r.FeatureService){const e=null===(n=null==s?void 0:s.useDataSource)||void 0===n?void 0:n.dataSourceId,t=ce(s.configId,o);a=te(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=te(e)}const u=null==a?void 0:a.getStatus();u!==e.DataSourceStatus.Loading&&u!==e.DataSourceStatus.Unloaded||(i=!1)}return i},ve=t=>{var o,n;if(!t)return;const r=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==r?void 0:r.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},ge=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})};function pe(t,o){return Q(this,void 0,void 0,(function*(){const o=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getOutputDsJson:n}=o;return function(t){return Q(this,void 0,void 0,(function*(){if(!t||0===t.length)return Promise.resolve([]);const o=t.map((t=>({id:t.dataSourceJson.id,dataSourceJson:(0,e.Immutable)(t.dataSourceJson)})));return yield Promise.allSettled(o.filter((e=>e.layer)).map((e=>Q(this,void 0,void 0,(function*(){var t;const o=null===(t=e.layer.sourceJSON)||void 0===t?void 0:t.capabilities;o&&(yield e.layer.load(),e.layer.sourceJSON.capabilities=o)}))))),Promise.allSettled(o.map((t=>e.DataSourceManager.getInstance().createDataSource(t).then((e=>e.isDataSourceSet()&&!e.areChildDataSourcesCreated()?e.childDataSourcesReady().then((()=>e)):e))))).then((e=>e.filter((e=>"fulfilled"===e.status)).map((e=>e.value)))).then((e=>e.length<t.length?Promise.reject(new Error("Failed to create some data source.")):e))}))}(null==(t=null==t?void 0:t.filter((e=>{const t=null==e?void 0:e.outputDataSourceId;return!te(t)})))?void 0:t.map(((e,t)=>({dataSourceJson:n(e,!0),order:t}))))}))}const{useRef:me,useState:he,useEffect:fe}=e.React,Se=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  .dropdown-button-content {
    text-align: center;
  }
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,ye=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),[n,i]=he(!0),[l,s]=he(!1),[a,u]=e.React.useState(!1),{className:c,datasourceConfig:p,dsStatus:m,config:h,id:S,useDataSources:y,synchronizeSettings:b,showLoading:x,onDatasourceConfigChange:w}=t,C=me(null),j=me(null),M=me(null),R=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!o||!t)return;const r=ve(t)||{};r[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(r)})})(S,"serviceEnabledList",o)};fe((()=>{const e=null==p?void 0:p.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==p?void 0:p.length);s(o),i(t)}),[p]);return(0,e.jsx)("div",{className:`${c||""} ds-setting-${h.arrangementStyle}`,onKeyDown:t=>{"Escape"===t.key&&(u(!1),(0,e.focusElementInKeyboardMode)(j.current))},css:Se,role:"group","aria-label":o("searchIn",{value:""})},x&&(0,e.jsx)(v.Button,{icon:!0,className:"setting-dropdown-button"},(0,e.jsx)(v.Loading,{width:14,height:14,type:v.LoadingType.Donut})),!x&&(0,e.jsx)(v.Dropdown,{className:"w-100 h-100",menuItemCheckMode:"multiCheck",toggle:t=>{a||setTimeout((()=>{(0,e.focusElementInKeyboardMode)(M.current,!0)}),200),u(!a)},isOpen:a},(0,e.jsx)(v.DropdownButton,{ref:j,className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(I,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(v.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:C},(0,e.jsx)(v.DropdownItem,{toggle:!1,onClick:()=>{const e=!n,t=null==p?void 0:p.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));R(t),w(t)},title:o("all"),ref:M},(0,e.jsx)(v.Checkbox,{checked:n&&!l,indeterminate:l,className:"mr-2"}),o("all")),(0,e.jsx)(v.DropdownItem,{divider:!0}),null==p?void 0:p.map(((t,n)=>{var i;const l=m[t.configId]===e.DataSourceStatus.LoadError||m[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===r.GeocodeService,a=((t,o=!1)=>{var n;let r;if(!1!==b&&(null==h?void 0:h.sourceType)===d.MapCentric)return!0;if(o){const o=(0,e.getAppStore)().getState().appConfig,i=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[S],l=(null==i?void 0:i.outputDataSources)||[];r=(null==l?void 0:l.filter((e=>t===e)).length)>0}else r=(null==y?void 0:y.filter((e=>t===e.dataSourceId)).length)>0;return r&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(i=null==p?void 0:p.filter((e=>null==e?void 0:e.enable)))||void 0===i?void 0:i.length)&&(null==t?void 0:t.enable)&&l;return(0,e.jsx)(v.DropdownItem,{toggle:!1,key:`${null==t?void 0:t.label}${n}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==p?void 0:p.setIn([t,"enable"],e);R(o),w(o)})(!(null==t?void 0:t.enable),n)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(v.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(l||!a)&&(0,e.jsx)(v.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var be=a(972),Ie=a(888);const xe=(t,o)=>{var n,r,i,l,s,a,u,c,d,v,g,p,m,h;return e.css`
    & {
      padding-top: 0;
      padding-bottom: 0;
      box-sizing: border-box;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(r=null===(n=null==t?void 0:t.sys.color)||void 0===n?void 0:n.secondary)||void 0===r?void 0:r.dark};
      background-color: ${null===(l=null===(i=null==t?void 0:t.ref.palette)||void 0===i?void 0:i.neutral)||void 0===l?void 0:l[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(s=null==t?void 0:t.ref.palette)||void 0===s?void 0:s.black};
      background-color: ${null===(u=null===(a=null==t?void 0:t.ref.palette)||void 0===a?void 0:a.neutral)||void 0===u?void 0:u[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(c=null==t?void 0:t.ref.palette)||void 0===c?void 0:c.black};
      background-color: ${null===(v=null===(d=null==t?void 0:t.ref.palette)||void 0===d?void 0:d.neutral)||void 0===v?void 0:v[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(g=null==t?void 0:t.sys.color)||void 0===g?void 0:g.primary.main};
      color: ${null===(p=null==t?void 0:t.ref.palette)||void 0===p?void 0:p.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(m=null==t?void 0:t.ref.palette)||void 0===m?void 0:m.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(h=null==t?void 0:t.ref.palette)||void 0===h?void 0:h.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},{useEffect:we,useRef:Ce}=e.React,je={apply({elements:e,rects:t}){const o=t.reference.width;o&&(e.floating.style.width=`${o}px`)}},Me={apply({elements:e,rects:t}){"33px"!==e.floating.style.width&&(e.floating.style.width="33px")}},Re=t=>{const n=Ce(null),r=Ce(null),{children:i,isOpen:l,reference:s,searchInputRef:a,autoFocus:u,className:c,differentWithReferenceWidth:d,isFocusWithSearchInput:g,id:p,offset:m,containerEventPreventDefault:h,toggle:f}=t,S=(0,Ie.useTheme)(),y=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[p])||void 0===t?void 0:t.state}));we((()=>{var e;return(null==a?void 0:a.current)&&g&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",b,!0)),()=>{var e;g&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",b,!0))}}),[]);const b=e.hooks.useEventCallback((t=>{if(!l)return!1;const o=w()||[],n=(null==o?void 0:o.length)-1;"ArrowUp"===t.key?r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[n])})):"ArrowDown"===t.key&&(r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[0])})))})),I=e.hooks.useEventCallback((t=>{if(!l)return;const o="button"===t.target.getAttribute("role")||"option"===t.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown","Escape"].includes(t.key)&&((t.which>=48&&t.which<=90||"Tab"===t.key)&&t.preventDefault(),l&&o))if(clearTimeout(r.current),"Escape"===t.key)x(t);else if(["ArrowUp","ArrowDown","Tab"].includes(t.key)||["n","p"].includes(t.key)&&t.ctrlKey){const o=w();let i=o.indexOf(t.target),l=!1;"ArrowUp"===t.key||"p"===t.key&&t.ctrlKey||"Tab"===t.key&&(t.shiftKey||1===o.length)?(i=0!==i?i-1:o.length-1,l=!0):("ArrowDown"===t.key||"Tab"===t.key||"n"===t.key&&t.ctrlKey)&&(l=!1,i=i===o.length-1?0:i+1);const s=0===i&&!l,u=i===o.length-1&&l;g&&(s||u)?r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(a.current,!0)})):((0,e.focusElementInKeyboardMode)(Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0],!0),r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[i],!0)}))),["ArrowUp","ArrowDown"].includes(t.key)&&t.preventDefault()}else if("End"===t.key){const t=w();r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[t.length-1],!0)}))}else if("Home"===t.key){const t=w();r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t[0],!0)}))}else if(t.which>=48&&t.which<=90){const o=w(),n=String.fromCharCode(t.which).toLowerCase();for(let t=0;t<o.length;t+=1){if((o[t].textContent&&o[t].textContent[0].toLowerCase())===n){r.current=setTimeout((()=>{(0,e.focusElementInKeyboardMode)(o[t],!0)}));break}}}})),x=t=>{t.preventDefault(),C(t),e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current,!0)}))},w=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"], [role="option"]')).filter((e=>!e.disabled)):[],C=t=>{f(t),"Escape"===(null==t?void 0:t.key)&&e.lodash.defer((()=>{(0,e.focusElementInKeyboardMode)(null==a?void 0:a.current)}))};return(0,e.jsx)("div",null,(0,e.jsx)(v.Popper,{autoFocus:u,placement:"bottom-start",open:l,toggle:C,reference:s,autoUpdate:!0,offsetOptions:m||o,ref:n,sizeOptions:d?Me:je,forceLatestFocusElements:!0},(0,e.jsx)("div",{onMouseDown:e=>{h&&e.preventDefault()},css:xe(S),className:(0,e.classNames)("result-list-popper",c,{"hide-popper":y===e.WidgetState.Closed})},(0,e.jsx)("div",{style:{userSelect:"none"},onKeyDown:I},i))))},{useState:Te,useRef:ke,useEffect:Le}=e.React,Pe=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,Ee=t=>{const o=e.hooks.useTranslation(v.defaultMessages,e.defaultMessages),n=ke(null),{serviceList:i,open:l,toggleUtilityErrorRemind:s}=t,[a,u]=Te(null),c=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));Le((()=>{l&&(clearTimeout(n.current),n.current=setTimeout((()=>{s(!1)}),5e3))}),[l]),Le((()=>{d(c)}),[c]);const d=e=>{var t;if(!i)return;let o=null,n=[],l=[];if(null===(t=Object.keys(i))||void 0===t||t.forEach((t=>{var o;const s=i[t];if(s.searchServiceType===r.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?l.push(t):!1===(null==o?void 0:o.success)&&n.push(t)}}})),n=g(n),l=g(l),0===(null==n?void 0:n.length)&&(null==l?void 0:l.length)>0)o=p(l);else if(0===(null==l?void 0:l.length)&&(null==n?void 0:n.length)>0)o=m(n);else if((null==l?void 0:l.length)>0&&(null==n?void 0:n.length)>0){o=`${p(l)} ${m(n)}`}u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),p=e=>{let t=null;return 1===le(i)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},m=e=>{let t=null;return 1===le(i)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"position-relative w-100",css:Pe},(0,e.jsx)("div",{className:"w-100 utility-err-remind-con"},(0,e.jsx)(v.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:Ne}=e.React,Oe=new(0,e.esri.Sanitizer),De=t=>{const{className:o,reference:n,searchSuggestion:r,isOpen:i,canUseOutputDsLength:l,id:s,searchInputRef:a,openUtilityErrRemindInSuggestion:u,serviceList:c,searchText:d,toggleSuggestionUtilityError:g,toggle:p,onRecordItemClick:m,setSuggestionFirstItem:h}=t,f=(0,Ie.useTheme)(),S=Ne(!1),y=()=>{if((null==r?void 0:r.length)<2)return!1;let e=0,t=0;return null==r||r.forEach((o=>{var n;const r=null==o?void 0:o.icon;r&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&r&&(t+=1)})),t>0&&e>0},b=(t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,r=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,i)=>{var s;const a=Oe.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${i}`,title:n.suggestion,"aria-label":n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:r}=t||{};o&&(n||r)?m(e,t):m(e)})(n.suggestion,u)},ref:e=>{I(i,e)}},r&&1===l&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(s=null==f?void 0:f.sys.color)||void 0===s?void 0:s.primary.main,size:16,icon:null==r?void 0:r.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:a}}))}))},I=(e,t)=>{0===e&&!S.current&&t&&(h(t),S.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Re,{isOpen:i&&!(()=>{let e=[];return r.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),d&&0===e.length})()||u,autoFocus:!1,reference:n,searchInputRef:a,isFocusWithSearchInput:!0,toggle:p,id:s,containerEventPreventDefault:!0,className:(0,e.classNames)("result-list-con suggestion-list-con",o)},!u&&(S.current=null,null==r?void 0:r.map(((t,o)=>{var n,i,l;const s=(null==r?void 0:r.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"listbox","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(v.Button,{"aria-label":null==t?void 0:t.layer,role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(i=null==f?void 0:f.sys.color)||void 0===i?void 0:i.primary.main,size:16,icon:null===(l=null==t?void 0:t.icon)||void 0===l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.layer)),b(t,y()))}))),u&&(0,e.jsx)(Ee,{open:u,serviceList:c,toggleUtilityErrorRemind:g})))};var Ae=a(44),Fe=a.n(Ae),Ue=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Be=t=>{const o=window.SVG,{className:n}=t,r=Ue(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:Fe()},r)):e.React.createElement("svg",Object.assign({className:i},r))};var He=a(210),$e=a.n(He),Ge=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const Ve=t=>{const o=window.SVG,{className:n}=t,r=Ge(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:$e()},r)):e.React.createElement("svg",Object.assign({className:i},r))};var Je=a(996),We=a.n(Je),Ke=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const _e=t=>{const o=window.SVG,{className:n}=t,r=Ke(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:We()},r)):e.React.createElement("svg",Object.assign({className:i},r))},qe=t=>{const o=e.hooks.useTranslation(g,v.defaultMessages),{serviceList:i,locationLoading:l,isGetLocationError:s,onLocationChange:a,handleLocationLoadingChange:u}=t,[c,d]=e.React.useState(null);e.React.useEffect((()=>{p()}),[i]);const p=()=>{var e;for(const t in i){const o=null===(e=i[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===r.GeocodeService){d(o);break}}},m=e=>{u(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;if(c){((e,t,o=n)=>t?(0,x.loadArcGISJSAPIModules)(["esri/rest/locator","esri/geometry/SpatialReference"]).then((n=>{const[r,i]=n;return J(t,o).then((t=>{const n=new i(o);return r.locationToAddress(e,{location:t,outSpatialReference:n},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),Promise.reject(new Error(e.message)))))}))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e,null==c?void 0:c.spatialReference).then((e=>{a(e)}),(e=>{a(t)}))}else a(t)},h=e=>{u(!1),a(null,null,!0)};return(0,e.jsx)("div",null,!s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button",onClick:()=>{if(l)return!1;u(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(m,h)},"aria-label":o("useCurrentLocation"),title:o("useCurrentLocation")},(0,e.jsx)(Ve,{className:"mr-2"}),o("useCurrentLocation")),s&&(0,e.jsx)(v.Button,{className:"text-left d-block",role:"button","aria-label":o("couldNotRetrieve"),title:o("couldNotRetrieve")},(0,e.jsx)(_e,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:ze}=e.React,Qe=new(0,e.esri.Sanitizer),Ye=t=>{var o,n,r,i;const l=e.hooks.useTranslation(g,v.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:c,isGetLocationError:d,serviceList:p,config:m,id:h,searchInputRef:f,locationLoading:S,toggle:y,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:x,handleLocationLoadingChange:w}=t,C=ze(!1),j=t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const r=Qe.sanitize(o.suggestionHtml),i={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,"aria-label":o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:r}=t||{};o&&(n||r)?b(e,t):b(e)})(o.suggestion,i)},ref:e=>{M(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:r}}))}))},M=(e,t)=>{0!==e||C.current||(x(t),C.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(Re,{isOpen:c,autoFocus:!1,reference:a,searchInputRef:f,isFocusWithSearchInput:!0,toggle:y,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},m.isUseCurrentLoation&&(0,e.jsx)(qe,{serviceList:p,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:S,isGetLocationError:d,handleLocationLoadingChange:w}),(C.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},j(t))))),m.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(v.DropdownItem,{divider:!0}),m.isShowRecentSearches&&(null===(i=null===(r=u[0])||void 0===r?void 0:r.suggestionItem)||void 0===i?void 0:i.length)>0&&(0,e.jsx)(v.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside text-left d-block","aria-label":l("clearRecentSearches"),title:l("clearRecentSearches"),onClick:I},(0,e.jsx)(Be,{className:"mr-2"}),l("clearRecentSearches"))))},{useEffect:Xe,useRef:Ze}=e.React,et=t=>{const n=e.hooks.useTranslation(g),{reference:r,searchText:l,id:a,config:u,serviceList:c,isOpenResultListDefault:d,searchInputRef:p,searchResult:m,selectionList:h,openUtilityErrRemindInResult:S,isOpenResultPopper:y,isToOtherWidget:b,datasourceConfig:x,toggleResultUtilityError:w,setResultFirstItem:C,handleDsIdOfSelectedResultItemChange:j}=t,{resultMaxNumber:M}=u,R=Ze([]),T=Ze(!1),k=Ze(null),L=Ze(null),P=Ze(!1),E=Ze((0,e.Immutable)({})),N=Ze({}),O=Ze(null),D=Ze(!1),A=Ze(!1),F=Ze(null),U=e.ReactRedux.useSelector((e=>e.appContext.isRTL));let B={};const H=(0,Ie.useTheme)(),[$,G]=e.React.useState((0,e.Immutable)({})),[V,J]=e.React.useState(d),[W,K]=e.React.useState(s.Classic),[_,q]=e.React.useState(!1),[z,Q]=e.React.useState(o);Xe((()=>{R.current=[],F.current=l}),[l]),Xe((()=>{T.current=!1;de(null==c?void 0:c.asMutable({deep:!0}),a)&&(b||y)&&Y()}),[m,b,y]),Xe((()=>{(y||b)&&(J(!0),A.current=!0,D.current=!1,G((0,e.Immutable)({})),N.current={})}),[y,b]),Xe((()=>{(null==u?void 0:u.searchResultStyle)&&(null==u?void 0:u.searchResultStyle)!==W&&K(null==u?void 0:u.searchResultStyle)}),[u]),Xe((()=>{Se(W,V,_)}),[W,V,_]);const Y=()=>{const t=ee(null==c?void 0:c.asMutable({deep:!0}),M,a);Promise.all([t]).then((t=>{T.current=!0;let o=(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const r={};n.forEach((e=>{const{records:t,configId:n,dsId:i,isGeocodeRecords:l,localDsId:s}=e;r[n]=t;let a=ce(t,n,i,l,s);a=X(a),ve(a),o=o.setIn([n],a)})),E.current=o,(null==u?void 0:u.searchResultView)!==i.OtherWidgets&&G(o),N.current=r,pe()}))},X=e=>e.sort(((e,t)=>{var o,n,r,i,l,s;const a=null===(n=null===(o=null==e?void 0:e.value)||void 0===o?void 0:o.join(","))||void 0===n?void 0:n.toLocaleLowerCase(),u=null===(i=null===(r=null==t?void 0:t.value)||void 0===r?void 0:r.join(","))||void 0===i?void 0:i.toLocaleLowerCase();return(a.startsWith(null===(l=F.current)||void 0===l?void 0:l.toLocaleLowerCase())?0:1)-(u.startsWith(null===(s=F.current)||void 0===s?void 0:s.toLocaleLowerCase())?0:1)})),Z=()=>{var e;if(le(c)<2)return!1;let t=0,o=0;for(const n in $){const r=ie(x,n),i=null==r?void 0:r.icon;i&&(t+=1),(null===(e=$[n])||void 0===e?void 0:e.length)>0&&i&&(o+=1)}return o>0&&t>0},oe=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,r)=>{var i,l,s,a;const{configId:u,value:d,recordId:g,outputDsId:p}=t,m=ge(u,g),h=null===(l=null===(i=null==o?void 0:o.asMutable({deep:!0}))||void 0===i?void 0:i[u])||void 0===l?void 0:l.includes(g),f=ie(x,u),S=null==f?void 0:f.icon,y=h?null===(s=null==H?void 0:H.ref.palette)||void 0===s?void 0:s.white:null===(a=null==H?void 0:H.sys.color)||void 0===a?void 0:a.primary.main,b=le(c);return(0,e.jsx)(v.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:m,role:"option","aria-selected":h,active:h,title:d.join(", "),"aria-label":d.join(", "),ref:e=>{ne(r,e)},onClick:()=>{re({isActive:h,key:m,recordId:g,dsId:p,configId:u})}},S&&1===b&&(0,e.jsx)(v.Icon,{className:"mr-2",color:y,size:16,icon:null==S?void 0:S.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},d.join(", ")))})))),ne=(e,t)=>{0===e&&!P.current&&A.current&&t&&(C(t),P.current=!0)},re=e.hooks.useEventCallback((e=>{var t,o,n,r,i,l;const{isActive:s,recordId:a,dsId:u,configId:c}=e,d=null===(n=null===(o=null===(t=E.current)||void 0===t?void 0:t[c])||void 0===o?void 0:o[0])||void 0===n?void 0:n.localDsId,v=null===(l=null===(i=null===(r=E.current)||void 0===r?void 0:r[c])||void 0===i?void 0:i[0])||void 0===l?void 0:l.isGeocodeRecords,g=te(v?u:d),p=s?[]:ue(c,a);se(u,d,p),j(a?u:null),a&&(!s&&ae(c),clearTimeout(O.current),O.current=setTimeout((()=>{s?null==g||g.selectRecordsByIds([]):null==g||g.selectRecordsByIds([a])}),100))})),se=(t,o,n)=>{var r;if(o){const e=te(t);n=n.map((t=>e.buildRecord(t.feature)))}const i=new e.DataRecordsSelectionChangeMessage(a,n,[t]),l=null===(r=n[0])||void 0===r?void 0:r.__extent;l&&(i.extent=l),e.MessageManager.getInstance().publishMessage(i)},ae=e=>{var t,o,n,r,i,l;const s=E.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(r=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===r?void 0:r.localDsId,c=null===(l=null===(i=null==s?void 0:s[a])||void 0===i?void 0:i[0])||void 0===l?void 0:l.isGeocodeRecords,d=te(c?e:u);d&&d.selectRecordsByIds([])}},ue=(e,t)=>{var o;const n=(null===(o=N.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},ce=(t,o,n,r,i)=>{var l;const s=(null===(l=null==c?void 0:c[o])||void 0===l?void 0:l.displayFields)||[],a=[],u=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,u);(n||0===n)&&t.push(n)}));const l={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:r,localDsId:i};a.push(l)})),a},ve=e=>{e.forEach((e=>{!(null==B?void 0:B.recordId)&&e.recordId&&(B=e)}))},ge=(e,t)=>`${e}_${t}`,pe=()=>{const e=de(null==c?void 0:c.asMutable({deep:!0}),a);if(!(null==u?void 0:u.isAutoSelectFirstResult)||!(null==B?void 0:B.recordId)||D.current||!e)return;const{configId:t,recordId:o,outputDsId:n}=B,r=ge(t,o);re({isActive:!1,key:r,recordId:o,dsId:n,configId:t}),D.current=!0},me=()=>{Se(W,!V,_),V&&C(L.current),J(!V),A.current=!V},he=e.React.useCallback((e=>{var t;let o=0;for(const n in e){o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0}const n=le(c);q(0===n||0===o&&T.current)}),[c]),fe=e.hooks.useEventCallback((e=>{V&&(J(!1),A.current=!1,C(L.current))})),Se=(e,t,n)=>{var i;let l=o;if(e===s.Compact)if(t||n)l=o;else{const e=(null===(i=null==r?void 0:r.current)||void 0===i?void 0:i.clientWidth)/2-15||0;l=U?[-e,0]:[e,0]}else l=o;Q(l)};return Xe((()=>{he($)}),[$,he]),(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(Re,{isOpen:y,isFocusWithSearchInput:!0,autoFocus:!1,reference:r,searchInputRef:p,toggle:fe,id:a,offset:z,differentWithReferenceWidth:((e,t,o)=>t===s.Compact&&!e&&!!o)(V,W,l),className:(0,e.classNames)("result-list-con",W!==s.Compact||_?"":V?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content",role:"listbox"},!S&&(0,e.jsx)("div",{ref:k},_&&(0,e.jsx)(v.Button,{role:"button",className:"text-center",disabled:!0,"aria-label":n("noResult",{searchText:l}),title:n("noResult",{searchText:l})},(0,e.jsx)("span",{role:"warning"},n("noResult",{searchText:l}))),!_&&(0,e.jsx)("div",null,W===s.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(v.Button,{role:"button",ref:L,className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:me,"aria-label":n("searchResults"),title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!V&&l?(0,e.jsx)(f,null):(0,e.jsx)(I,null)),V&&(0,e.jsx)(v.DropdownItem,{divider:!0})),V&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];P.current=null;for(const r in $){const i=null===(t=null==$?void 0:$.asMutable({deep:!0}))||void 0===t?void 0:t[r],l=ie(x,r),s=null==l?void 0:l.label,a=null==l?void 0:l.icon,u=le(c),d=(0,e.jsx)("div",{key:`${r}_${s}_con`,role:"group",title:"label","aria-label":s},i.length>0&&(0,e.jsx)("div",null,u>1&&(0,e.jsx)(v.Button,{role:"button","aria-label":s,className:"source-label-con jimu-outline-inside",disabled:!0,key:`${r}_${s}`,title:s},a&&(0,e.jsx)(v.Icon,{className:"mr-2",color:null===(o=null==H?void 0:H.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null==a?void 0:a.svg}),(0,e.jsx)("div",{className:"flex-grow-1"},s)),oe(i,h,Z())));n.push(d)}return n})()),W===s.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},V&&(0,e.jsx)(v.DropdownItem,{divider:!0}),(0,e.jsx)(v.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:me,title:n("searchResults"),"aria-label":n("searchResults")},!V&&l?(0,e.jsx)(f,{size:10}):(0,e.jsx)(I,{size:10}))))),S&&(0,e.jsx)(Ee,{open:S,serviceList:c,toggleUtilityErrorRemind:w}))))};var tt=a(170),ot=a.n(tt),nt=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};const rt=t=>{const o=window.SVG,{className:n}=t,r=nt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:i,src:ot()},r)):e.React.createElement("svg",Object.assign({className:i},r))},{useSelector:it}=e.ReactRedux,{useState:lt,useEffect:st,useRef:at,useMemo:ut}=e.React,ct=(0,be.forwardRef)(((t,o)=>{const n=(0,Ie.useTheme)(),s=e.hooks.useTranslation(g,v.defaultMessages),a=it((e=>null==e?void 0:e.queryObject)),u=it((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),c=at((e=>{})),p=at(null),m=at(null),h=at([]),f=at(null),S=at(null),y=at(null),b=at(!1),I=at(!1),x=at(!1),w=at(null),C=at(null),j=at(null),M=at(!1),R=at(!1),T=at(null),k=at(null),L=at(null);(0,be.useImperativeHandle)(o,(()=>({setSearchValue:e=>{Re(e),k.current&&k.current.focus()}})));const P=at(!1),E=at(null),O=at(!1),A=at(null),F=at(null),U=at(!1),B=at(!1),H=at(!1),{config:$,className:G,reference:V,id:J,isShowSearchInput:W,isInCurrentView:q,isWidgetInCurrentPage:z,serviceList:Q,searchResult:oe,selectionList:ie,datasourceConfig:se,loadingServiceList:pe,showSearchSetting:me,jimuMapView:he,handleServiceListChange:fe,clearSearchResult:Se}=t,{isShowRecentSearches:ye,recentSearchesMaxNumber:xe,linkParam:we,searchResultView:Ce,resultMaxNumber:je}=$,[Me,Re]=lt(null),[Te,ke]=lt(!1),[Le,Pe]=lt(!1),[Ee,Ne]=lt(!1),[Oe,Ae]=lt([]),[Fe,Ue]=lt({}),[Be,He]=lt(!1),[$e,Ge]=lt(!1),[Ve,Je]=lt(!1),[We,Ke]=lt(null),[_e,qe]=lt(!1),[ze,Qe]=lt(!1),[Xe,Ze]=lt([]),[tt,ot]=lt(!1),[nt,ct]=lt(null),[dt,vt]=lt(!1),[gt,pt]=lt(!1),mt=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    input::-webkit-contacts-auto-fill-button{
      opacity: 0 !important;
      visibility: hidden;
    }
    .loading-con {
      left: 0;
      top: 0;
      right: 0;
      height: 2px;
    }
    .hide-loading {
      opacity: 0;
      visibility: hidden;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--ref-palette-neutral-600);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
    //https://devtopia.esri.com/Beijing-R-D-Center/ExperienceBuilder-Web-Extensions/issues/26291#issuecomment-5527033
    //Because after the theme is updated, the color of the input placeholder is set, which causes a regression issue.
    //In order to deal with this regression issue, special processing is required under the dark theme.
    .in-dark-theme input::placeholder {
      color: #868686 !important;
    }
  `;st((()=>{O.current&&q&&z?(Je(!1),e.lodash.defer((()=>{Pt(!0)}))):Je(!0),q&&z||Et()}),[q,z]),st((()=>{!_e&&P.current&&ft(!0,!1),P.current=_e}),[Be,_e]),st((()=>{Be&&u===e.AppMode.Design&&Et()}),[u]),st((()=>{c.current=e.lodash.debounce(wt,400),Zt(Q,null==$?void 0:$.hint)}),[$]),st((()=>{b.current&&(yt(Q),St(Q,I.current),Rt(Q));const e=kt(Q);h.current=e,I.current=null==$?void 0:$.enableFiltering,x.current=!0}),[Q,$.enableFiltering]),st((()=>{y.current=Q,Q&&(b.current=!0);const e=(null==$?void 0:$.sourceType)!==d.MapCentric||!pe;Zt(Q,null==$?void 0:$.hint),Ct(Q),!R.current&&Q&&e&&(ht(Q),R.current=!0)}),[Q,pe]);const ht=e.hooks.useEventCallback((e=>{var t;const o=ve(J),{searchText:n,status:i}=o;i&&(i.isFromSuggestion=!0),n&&(e&&0!==(null===(t=Object.keys(e))||void 0===t?void 0:t.length)||(zt(n,i),Ft(n)),clearTimeout(E.current),E.current=setTimeout((()=>{((e,t)=>{var o;let n=!0;for(const i in e){const l=e[i];let s;if(l.searchServiceType===r.FeatureService)ue(null===(o=null==l?void 0:l.useDataSource)||void 0===o?void 0:o.dataSourceId,ce(l.configId,t))||(n=!1);else{const e=null==l?void 0:l.outputDataSourceId;s=te(e),s||(n=!1)}}return n})(null==e?void 0:e.asMutable({deep:!0}),J)&&eo()>0?(zt(n,i),Ft(n)):ht(e)}),300))})),ft=(e=!1,t=!0)=>{t&&ot(!1),e||(B.current=!1),Qe(e)},St=(e,t)=>{if(!x.current)return!1;t!==(null==$?void 0:$.enableFiltering)&&(clearTimeout(m.current),m.current=setTimeout((()=>{var o;jt(!1),Se();for(const n in e){(null===(o=e[n])||void 0===o?void 0:o.searchServiceType)===r.FeatureService&&Z(e[n],J,n,t)}})))},yt=e=>{if(!x.current||!T.current)return!1;const t=y.current||{},o=bt(e),n=bt(y.current),i=(null==n?void 0:n.filter((e=>!(null==o?void 0:o.includes(e)))))||[];Object.keys(e||{}).length!==Object.keys(t||{}).length&&(clearTimeout(m.current),m.current=setTimeout((()=>{jt(!1),Se(),null==i||i.forEach((e=>{var o,n;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===r.FeatureService?Z(t[e],J,e,null==$?void 0:$.enableFiltering):Lt(null===(n=t[e])||void 0===n?void 0:n.outputDataSourceId)}))})))},bt=e=>e?Object.keys(e).map((e=>e)):[],It=(e=!1)=>{vt(e)},xt=(e=!1)=>{pt(e)},wt=e.hooks.useEventCallback((e=>{var t;if(0===(null==$?void 0:$.maxSuggestions))return void ke(!1);!Te&&ke(!0);const o=(e=>{const{searchText:t,serviceList:o,config:n,datasourceConfig:i,jimuMapView:l}=e,s=[];for(const e in o){const a=o[e];let u;a.maxSuggestions=n.maxSuggestions;const c=Y(n.sourceType,null==a?void 0:a.searchInCurrentMapExtent,l);u=a.searchServiceType===r.FeatureService?K(t,n,a,i,c):N(t,a,c,l),s.push(u)}return Promise.all(s)})({searchText:e,serviceList:null===(t=null==w?void 0:w.current)||void 0===t?void 0:t.asMutable({deep:!0}),config:$,datasourceConfig:se,jimuMapView:he});Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&It(!0),ke(!1),o&&Ae(o),M.current||T.current&&Pe(!0),M.current=!1})).catch((e=>{ke(!1)}))})),Ct=e.hooks.useEventCallback((e=>{if(!x.current)return!1;let t=!1;for(const o in e){const n=e[o];((null==n?void 0:n.searchServiceType)===r.FeatureService||(null==n?void 0:n.isSupportSuggest))&&(t=!0)}Ne(t)})),jt=(t=!0)=>{zt(""),ke(!1),Pt(!1),Ft("",!0),clearTimeout(L.current),t&&(0,e.focusElementInKeyboardMode)(k.current)},Mt=e.hooks.useEventCallback((()=>{var e,t;for(const o in Q)if((null===(e=Q[o])||void 0===e?void 0:e.searchServiceType)===r.GeocodeService){const e=null===(t=Q[o])||void 0===t?void 0:t.outputDataSourceId;Lt(e)}})),Rt=t=>{var o;let n=!1;const r=kt(t);if(((null==r?void 0:r.length)!==h.current.length||(null===(o=null==r?void 0:r.filter((e=>!h.current.includes(e))))||void 0===o?void 0:o.length)>0)&&(n=!0),n){const t=new e.DataRecordSetChangeMessage(J,e.RecordSetChangeType.Remove,h.current);e.MessageManager.getInstance().publishMessage(t)}},Tt=e.hooks.useEventCallback((()=>{const t=kt(Q),o=new e.DataRecordSetChangeMessage(J,e.RecordSetChangeType.Remove,t);e.MessageManager.getInstance().publishMessage(o)})),kt=e=>{var t,o;const n=[];for(const i in e)if((null===(t=e[i])||void 0===t?void 0:t.searchServiceType)===r.GeocodeService){const t=null===(o=e[i])||void 0===o?void 0:o.outputDataSourceId;n.push(t)}return n},Lt=t=>{const o=te(t);null==o||o.selectRecordsByIds([]),ae(o,e.DataSourceStatus.NotReady)},Pt=e=>{O.current=e,e||Je(!0),He(e),Ge(e)},Et=()=>{He(!1)},Nt=()=>{let e=!0;if(!S.current)return e;const t=S.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Ot=(t,o,n)=>{if(n)return At(),!1;Dt(t,o),zt(t,o),Ft(t),(0,e.focusElementInKeyboardMode)(k.current)},Dt=(e,t)=>{const o=ve(J)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}ge(J,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};ge(J,e)}else ge(J,null)},At=()=>{(0,e.focusElementInKeyboardMode)(k.current),ot(!0),ft(!0,!1)},Ft=e.hooks.useEventCallback(((e,t=!1)=>{if(Be&&!t)return;e=null==e?void 0:e.trim(),Wt(e),Pe(!1),ft(!1),Ut(),fe(w.current),M.current=!0;const o={serviceList:S.current,searchText:e,searchResultView:Ce,id:J,sourceType:null==$?void 0:$.sourceType,jimuMapView:he};Dt(e),ke(!0),(e=>{const{serviceList:t,searchText:o,searchResultView:n,sourceType:l,jimuMapView:s,id:a}=e,u=[];for(const e in t){const c=t[e],{searchServiceType:d,resultMaxNumber:v}=c;if(d===r.GeocodeService){const e=n===i.ResultPanel?v:null,t=Y(l,null==c?void 0:c.searchInCurrentMapExtent,s),r=D({address:o,maxResultNumber:e,geocodeItem:c,searchResultView:n,extent:t,jimuMapView:s,id:a});u.push(r)}}return Promise.all(u)})(o).then((t=>{var n;ke(!1),(null===(n=null==t?void 0:t.filter((e=>"boolean"==typeof e)))||void 0===n?void 0:n.length)>0&&xt(!0),M.current=!1,(null==$?void 0:$.enableFiltering)&&(X(o),Ht()),e&&$t(e)}),(e=>{ke(!1)}))})),Ut=()=>{var t;const o=[];for(const e in w.current){const n=w.current[e],i=n.searchServiceType===r.FeatureService?null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId:null==n?void 0:n.outputDataSourceId;o.push(i)}if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(J,[],o)),nt){const e=te(nt);null==e||e.selectRecordsByIds([]),Bt(null)}Tt(),Mt()},Bt=e=>{ct(e)},Ht=e.hooks.useEventCallback((()=>{var t;const o=[];for(const e in Fe){const n=Fe[e];let i;(null==n?void 0:n.searchServiceType)===r.FeatureService?(i=null===(t=null==n?void 0:n.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(i)):(null==n?void 0:n.outputDataSourceId)&&o.push(null==n?void 0:n.outputDataSourceId)}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(J,o))})),$t=e=>{Ce===i.OtherWidgets?e&&(Jt()?Kt():Gt()):Vt()},Gt=()=>{if(!de(S.current,J))return clearTimeout(C.current),C.current=setTimeout((()=>{Gt()}),200),!1;const e=ee(S.current,je,J);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?Kt():Vt()}))},Vt=()=>{_t(),Pt(!0)},Jt=()=>{let e=[];return Oe.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Wt=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:r,isShowRecentSearches:i}=t,l=e.urlUtils.getAppIdPageIdFromUrl().appId,s=re(l,n);if(!i||!o)return!1;let a=ne(n);a.includes(o)||(a.unshift(o),a=a.splice(0,r||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:J,recentSearchesMaxNumber:xe,isShowRecentSearches:ye})},Kt=()=>{var e;if(!(null==p?void 0:p.current))return!1;_t(),Ge(!0),null===(e=null==p?void 0:p.current)||void 0===e||e.click()},_t=()=>{if(!de(S.current,J))return clearTimeout(j.current),j.current=setTimeout((()=>{_t()}),200),!1;const t=Ce===i.ResultPanel?je:100,o=ee(S.current,t,J,!0);Promise.all([o]).then((t=>{var o;let n=[];null==t||t.forEach((e=>{n=n.concat(e)}));let r,i=[];null==n||n.forEach((e=>{const t=(null==e?void 0:e.records)||[];i=i.concat(t)})),1===(null==i?void 0:i.length)&&(r=null===(o=i[0])||void 0===o?void 0:o.__extent),((t,o,n=e.RecordSetChangeType.CreateUpdate,r)=>{const i=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=te(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),r=null==o?void 0:o.getDataSourceJson(),l={records:e.records,fields:n,dataSource:o,name:o.id,label:null==r?void 0:r.label};i.push(l)}}));const l=new e.DataRecordSetChangeMessage(t,n,i);r&&(l.extent=r),e.MessageManager.getInstance().publishMessage(l)})(J,n,e.RecordSetChangeType.CreateUpdate,r)}))},qt=ut((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(we)),[we]),zt=(e,t)=>{Ae([]),Re(e),T.current=e,Qt(e,t)},Qt=e.hooks.useEventCallback(((t,o)=>{var n,i,l,s;const a=y.current;let u=y.current;t=null==t?void 0:t.trim();const c=$.sourceType===d.MapCentric?null===(n=null==he?void 0:he.view)||void 0===n?void 0:n.extent:null;for(const e in a){const o=null===(l=null===(i=a[e])||void 0===i?void 0:i.useDataSource)||void 0===l?void 0:l.dataSourceId;if(a[e].searchServiceType===r.GeocodeService||!ue(o))continue;const n=te(o),d=(null===(s=a[e].searchFields)||void 0===s?void 0:s.asMutable({deep:!0}))||[],v=_(t,d,n,a[e].searchExact||!1),g=_(t,d,n,!1);if(u=u.setIn([e,"SQL"],v).setIn([e,"SuggestionSQL"],g).setIn([e,"searchText"],t),c){const t=(null==c?void 0:c.toJSON)?null==c?void 0:c.toJSON():{};u=u.setIn([e,"searchExtent"],t)}}w.current=u,((t,o)=>{const{configId:n,magicKey:r,isFromSuggestion:i}=o||{};let l=(0,e.Immutable)(t);const s={};for(const e in l)e===n&&(r||i)&&(r&&(l=l.setIn([n,"magicKey"],r||null)),i&&(l=l.setIn([n,"isFromSuggestion"],i||null)),s[n]=l[n]);(r||i)&&Object.keys(t).includes(n)&&(l=(0,e.Immutable)(s));S.current=null==l?void 0:l.asMutable({deep:!0}),Ue(null==l?void 0:l.asMutable({deep:!0}))})(null==u?void 0:u.asMutable({deep:!0}),o)})),Yt=e=>{if(!e&&ye){const e=ne(J).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearch:!0})));Ze([{suggestionItem:e,layer:null,icon:null}]),ft(!0)}},Xt=e=>{!e&&(null==$?void 0:$.isUseCurrentLoation)&&(ft(!0),(null==$?void 0:$.isShowRecentSearches)||Ze([{suggestionItem:[],layer:null,icon:null}]))},Zt=e.hooks.useEventCallback(((e,t)=>{var o,n;if(!e)return;let r;const i=eo(e);for(const t in e)r=(null===(o=null==e?void 0:e[t])||void 0===o?void 0:o.hint)&&(null===(n=null==e?void 0:e[t])||void 0===n?void 0:n.hint);const l=t||(null==$?void 0:$.hint)||s("findAddressOrPlace");r=r||s("findAddressOrPlace");Ke(1!==i?l:r)})),eo=e.hooks.useEventCallback((e=>le(e=e||Q))),to=t=>{40===t.keyCode&&A&&(Le?(0,e.focusElementInKeyboardMode)(null==A?void 0:A.current,!0):Be?(0,e.focusElementInKeyboardMode)(null==f?void 0:f.current,!0):ze&&((0,e.focusElementInKeyboardMode)(null==F?void 0:F.current,!0),B.current=!0))},oo=()=>{if(_e)return!0;if(Te||Be)return!1;let e=!1;return(null==$?void 0:$.maxSuggestions)>0&&(e=Le&&Ee),e||(U.current=!1),e},no=()=>{Pe(!1)},ro=e.React.useCallback((()=>{var e,t;return!Me&&(!!((null==$?void 0:$.isShowRecentSearches)&&Xe&&(null===(t=null===(e=Xe[0])||void 0===e?void 0:e.suggestionItem)||void 0===t?void 0:t.length)>0)||!!(null==$?void 0:$.isUseCurrentLoation)&&!_e)}),[$,_e,Xe,Me]);return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${G||""} arrangement-${$.arrangementStyle}`,css:mt},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=oo();U.current=e,B.current=ze}to(e)}},W&&(0,e.jsx)(v.TextInput,{value:Me||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(zt(o),Be&&Ft("",!0),Pt(!1),!n||!Ee)return Pe(!1),0===(null==o?void 0:o.length)&&Ft("",!0),!1;c.current(o)},onFocus:e=>{if(U.current||B.current)return B.current=!1,U.current=!1,!1;Yt(T.current),Xt(T.current)},onPressEnter:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Nt()&&(zt(o),Ft(o)),to(e)},onBlur:e=>{L.current=setTimeout((()=>{U.current||Pe(!1),H.current||B.current||ft(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":me,"in-dark-theme":"themes/dark/"===(null==n?void 0:n.uri)}),allowClear:!0,prefix:$.arrangementStyle===l.Style2?(0,e.jsx)(rt,{className:"input-prefix-icon"}):null,placeholder:We,title:Me||We,ref:k,"aria-label":Me||We,autoComplete:"off"})),Me&&(0,e.jsx)(De,{canUseOutputDsLength:eo(),isOpen:oo(),reference:V,searchText:Me,searchSuggestion:Oe,toggle:no,onRecordItemClick:Ot,setSuggestionFirstItem:e=>{A.current=e},id:J,config:$,toggleSuggestionUtilityError:It,openUtilityErrRemindInSuggestion:dt,searchInputRef:k,serviceList:Q}),ro()&&(0,e.jsx)(Ye,{serviceList:le(Fe)>0?(0,e.Immutable)(Fe):Q,isOpen:ze||_e,reference:V,isGetLocationError:tt,recentSearchesData:Xe,toggle:no,onRecordItemClick:Ot,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=re(o,t);e.utils.setLocalStorage(n,"")})(J),Ze([]),Qe(!1)},setSuggestionFirstItem:e=>{F.current=e},id:J,config:$,searchInputRef:k,locationLoading:_e,handleLocationLoadingChange:e=>{e?(qe(e),H.current=e):setTimeout((()=>{qe(e),H.current=e}),300)}}),(0,e.jsx)(et,{isOpenResultPopper:Be,isToOtherWidget:$e,serviceList:(0,e.Immutable)(Fe),config:$,reference:V,searchText:Me,id:J,setResultFirstItem:e=>{f.current=e},isOpenResultListDefault:Ve,searchInputRef:k,searchResult:oe,selectionList:ie,openUtilityErrRemindInResult:gt,handleDsIdOfSelectedResultItemChange:Bt,toggleResultUtilityError:xt,datasourceConfig:se})),((t,o)=>{const n=t||o;return n?(0,e.jsx)("div",{className:(0,e.classNames)("position-absolute loading-con",{"hide-loading":!n})},(0,e.jsx)(v.Loading,{className:"w-100",type:v.LoadingType.Bar})):null})(Te,_e),$.arrangementStyle!==l.Style2&&(0,e.jsx)(v.Button,{className:"search-button h-100",type:$.arrangementStyle===l.Style3?"tertiary":"primary",icon:!0,"aria-label":s("SearchLabel"),onClick:()=>{(e=>{Nt()&&Ft(e)})(Me)},title:s("SearchLabel")},(0,e.jsx)(rt,null)),Ce===i.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(v.Link,{ref:p,to:null==qt?void 0:qt.linkTo,target:null==qt?void 0:qt.target,queryObject:a})))})),dt=ct,{useEffect:vt,useState:gt}=e.React,pt=t=>{const{config:o,id:n,serviceList:i,dsStatus:l,synchronizeSettings:s,jimuMapView:a,handleSearchResultChange:u,handleSelectionListChange:c,handleDsStatusChange:v}=t,[g,p]=gt(!1);vt((()=>{Object.keys(i||{}).forEach((e=>{var t;(null===(t=i[e])||void 0===t?void 0:t.searchText)&&p(!0)}))}),[i]);const m=(t,i,u)=>{if(t.searchServiceType===r.GeocodeService){const r=null==t?void 0:t.outputDataSourceId,l={dataSourceId:r,mainDataSourceId:r},a={where:"2=2",sqlExpression:null,pageSize:o.resultMaxNumber,outFields:["*"],page:1,returnGeometry:!0};if(!1!==s&&(null==o?void 0:o.sourceType)===d.MapCentric){const o=te(r);return(0,e.jsx)("div",{key:`${i}_con`},r&&(0,e.jsx)(e.DataSourceComponent,{dataSource:o,query:a,key:`${i}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,i)},onDataSourceStatusChange:e=>{f(t,i,e)},onSelectionChange:e=>{h(e,i)},widgetId:n}))}return(0,e.jsx)("div",{key:`${i}_con`},r&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(l),query:a,key:`${i}_outputDataSource`,onDataSourceInfoChange:e=>{f(t,i)},onDataSourceStatusChange:e=>{f(t,i,e)},onSelectionChange:e=>{h(e,i)},widgetId:n}))}if(t.searchServiceType===r.FeatureService){const r=null==t?void 0:t.useDataSource,s=function(t,o,n,r){const{searchText:i,useDataSource:l}=t,s=null==t?void 0:t.SQL,a=i?(null==s?void 0:s.sql)||"1=0":"1=1",u=i&&(null==s?void 0:s.sql)?s:null,c=q(t.searchFields,t.displayFields,null==l?void 0:l.dataSourceId);let v=(0,e.Immutable)({outFields:c,where:a,sqlExpression:u,returnGeometry:!0});if(n===d.MapCentric&&r){const e=null==o?void 0:o.view.extent,t=e?e.toJSON():{};v=v.set("geometry",t)}return v}(null==t?void 0:t.asMutable({deep:!0}),a,o.sourceType,t.searchInCurrentMapExtent),c=ce(i,n);return(0,e.jsx)("div",{key:`${i}_con`},r&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(r),query:u?s:null,key:`${i}_useDataSource`,onDataSourceInfoChange:e=>{f(t,i)},onSelectionChange:e=>{h(e,i)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{v((0,e.Immutable)(l.set(i,t)))},onCreateDataSourceFailed:t=>{v((0,e.Immutable)(l.set(i,e.DataSourceStatus.CreateError)))},localId:c}))}},h=(e,t)=>{c(e,t)},f=(t,i,s)=>{const{searchServiceType:a}=t;switch(a){case r.GeocodeService:V(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(i,o)}));break;case r.FeatureService:z(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,n).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));u(i,o)}))}s&&v((0,e.Immutable)(l.set(i,s)))};return(0,e.jsx)("div",null,((e,t)=>{const o=[];for(const n in e)o.push(m(e[n],n,t));return o})(i,g))};var mt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const ht=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=ht(e,t+=1))})),o};function ft(t){return mt(this,void 0,void 0,(function*(){yield function(t){return mt(this,void 0,void 0,(function*(){if(!t)return;const o=[];return Object.keys(t).forEach((n=>{const r=t[n],i=St(r),l=(null==i?void 0:i.layers)||[],s=(null==i?void 0:i.tables)||[],a=[],u=[];if(s.forEach((e=>{a.includes(null==e?void 0:e.id)||a.push(null==e?void 0:e.id)})),l.forEach((e=>{u.includes(null==e?void 0:e.id)||u.push(null==e?void 0:e.id)})),null==i?void 0:i.enabled){const r=t[n],i=r.jimuLayerViews,l=r.jimuTables,s=e.DataSourceManager.getInstance();Object.keys(l).forEach((e=>{const t=l[e],n=r.getDataSourceIdByAPILayer(t),i=s.getDataSource(n),u=r.getMapDataSource();if(!i&&u&&a.includes(null==t?void 0:t.id)){const e=function(e,t){return mt(this,void 0,void 0,(function*(){return yield e.createDataSourceByLayer(t).then((e=>Promise.resolve(e)),(e=>Promise.resolve(null)))}))}(u,t);o.push(e)}})),Object.keys(i).forEach((e=>{var t;const n=i[e];if(!n.getLayerDataSource()&&u.includes(null===(t=n.layer)||void 0===t?void 0:t.id)){const e=function(e){return mt(this,void 0,void 0,(function*(){return yield e.createLayerDataSource().then((e=>Promise.resolve(e)),(e=>Promise.resolve(null)))}))}(n);o.push(e)}}))}})),Promise.all(o)}))}(t);const o={},n=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getNewDataSourceConfig:r,getDsJsonOfOriginDs:i}=n,l=Object.keys(t||{}).map((n=>mt(this,void 0,void 0,(function*(){var l,s,a,u,c,d,v,g;const p=t[n],m=It(p),h=wt(p),f=null===(l=h[0])||void 0===l?void 0:l.jimuLayerViewsOrTable,S=null===(s=h[1])||void 0===s?void 0:s.jimuLayerViewsOrTable,y=0===(null===(a=Object.keys(f))||void 0===a?void 0:a.length)&&0===(null===(u=Object.keys(S))||void 0===u?void 0:u.length);let b=null===(c=null==o?void 0:o[n])||void 0===c?void 0:c.dataSourceConfig;if(y||0===(null==m?void 0:m.length))o[n]={dataSourceConfig:(null===(d=null==o?void 0:o[n])||void 0===d?void 0:d.dataSourceConfig)||[]};else{const t=e.DataSourceManager.getInstance();for(let l=0;l<h.length;l++){const{jimuLayerViewsOrTable:s,isTable:a}=h[l];for(const l in s||{}){const u=s[l],c=a?p.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(v=null==u?void 0:u.layer)||void 0===v?void 0:v.id,h=a?t.getDataSource(c):null==u?void 0:u.getLayerDataSource();if(!jt(n,null==h?void 0:h.id,o)&&m.includes(d)){const t={dataSourceId:h.id,mainDataSourceId:h.id,dataViewId:h.dataViewId,rootDataSourceId:null===(g=h.getRootDataSource())||void 0===g?void 0:g.id,viewId:n},l=yield i(t);Ct(p,u,a).forEach((i=>{var s;const a=null==i?void 0:i.field,u=(null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.exactMatch)||!1;let c;if(null==a?void 0:a.name){c=`${null==l?void 0:l.getLabel()}: ${a.name}`}const d={datasourceConfig:(0,e.Immutable)(b),dsJsonOriginDs:l,useDataSource:t,viewId:n,fieldsInMapSearchProperties:a?[a]:null,exactMatch:u,label:c},v=r(d);o[n]||(o[n]={}),o[n].dataSourceConfig=v.datasourceConfig,b=v.datasourceConfig}))}}}}return Promise.resolve(o)}))));return yield Promise.all(l),Promise.resolve(o)}))}const St=e=>{var t,o,n,r;if(!e)return null;const i=(null===(o=null===(t=e.view)||void 0===t?void 0:t.map)||void 0===o?void 0:o.applicationProperties)||null;return i?null===(r=null===(n=i.toJSON())||void 0===n?void 0:n.viewing)||void 0===r?void 0:r.search:null},yt=[e.JSAPILayerTypes.FeatureLayer,e.JSAPILayerTypes.SceneLayer,e.JSAPILayerTypes.BuildingComponentSublayer,e.JSAPILayerTypes.ImageryTileLayer,e.JSAPILayerTypes.OrientedImageryLayer,e.JSAPILayerTypes.ImageryLayer,e.JSAPILayerTypes.SubtypeGroupLayer,e.JSAPILayerTypes.SubtypeSublayer];function bt(t){if(!t||!t.type)return!1;const o=t.type,n=o!==e.JSAPILayerTypes.BuildingComponentSublayer||o===e.JSAPILayerTypes.BuildingComponentSublayer&&t.view;return!!(yt.includes(o)&&n)}const It=t=>{const o=St(t);if(!(null==o?void 0:o.enabled))return[];const n=[],r=e.DataSourceManager.getInstance();return wt(t).forEach((e=>{var i,l;const{jimuLayerViewsOrTable:s,isTable:a}=e;for(const e in s||{}){const u=s[e];if(!bt(u))continue;const c=a?t.getDataSourceIdByAPILayer(u):null,d=a?null==u?void 0:u.id:null===(i=null==u?void 0:u.layer)||void 0===i?void 0:i.id,v=a?r.getDataSource(c):null==u?void 0:u.getLayerDataSource();(null===(l=null==v?void 0:v.getDataSourceJson())||void 0===l?void 0:l.url)&&xt(u,o,a)&&n.push(d)}})),n};function xt(e,t,o){var n,r,i,l;const s=(null==t?void 0:t.layers)||[],a=(null==t?void 0:t.tables)||[],u=s.concat(a),c=o?null==e?void 0:e.id:null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.id;if("sublayer"===(null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.type)&&(null===(l=null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.parent)||void 0===l?void 0:l.id)){const t=e.layer.parent.id;let o=!1;return u.forEach((e=>{e.id===t&&(null==e?void 0:e.subLayer)===c&&(o=!0)})),o}{const e=(null==t?void 0:t.layers)||[],o=(null==t?void 0:t.tables)||[];return e.concat(o).map((e=>null==e?void 0:e.id)).includes(c)}}const wt=e=>[{jimuLayerViewsOrTable:null==e?void 0:e.jimuLayerViews,isTable:!1},{jimuLayerViewsOrTable:null==e?void 0:e.jimuTables,isTable:!0}],Ct=(e,t,o)=>{var n,r,i,l;const s=o?null==t?void 0:t.id:null===(n=null==t?void 0:t.layer)||void 0===n?void 0:n.id,a=St(e),u=(null==a?void 0:a.layers)||[],c=(null==a?void 0:a.tables)||[],d=u.concat(c);let v;return v="sublayer"===(null===(r=null==t?void 0:t.layer)||void 0===r?void 0:r.type)&&(null===(l=null===(i=null==t?void 0:t.layer)||void 0===i?void 0:i.parent)||void 0===l?void 0:l.id)?d.filter((e=>(null==e?void 0:e.id)===t.layer.parent.id&&(null==e?void 0:e.subLayer)===s))||[]:d.filter((e=>(null==e?void 0:e.id)===s))||[],v};function jt(e,t,o){var n;const r=null==o?void 0:o[e];if(!r)return!1;const i=null===(n=null==r?void 0:r.dataSourceConfig)||void 0===n?void 0:n.filter((e=>{var o;return t===(null===(o=null==e?void 0:e.useDataSource)||void 0===o?void 0:o.dataSourceId)}));return(null==i?void 0:i.length)>0}var Mt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const Rt={jimuName:w,alias:"ADDRESS",type:e.JimuFieldType.String,name:w},Tt=t=>Mt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class kt extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use array of Schema to set displayFields",upgrader:e=>{var t,o;const n=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===r.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Rt],e.addressFields=[Rt],e.defaultAddressFieldName=Rt.jimuName),e)));return e.setIn(["datasourceConfig"],n)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>Mt(this,void 0,void 0,(function*(){var o,n;const i=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):Tt(null==t?void 0:t.useUtility).then((o=>Mt(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],r=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=r,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}),(e=>Promise.resolve(t)))})))))),l=i?yield Promise.all(i):[];return t.setIn(["datasourceConfig"],l)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>Mt(this,void 0,void 0,(function*(){const o=yield(()=>Mt(this,void 0,void 0,(function*(){var o,n;const i=null===(n=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.map((t=>Mt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):Tt(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[r]=n;return r(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:r}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=ht(o,0),r={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(r),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),i=((null==t?void 0:t.addressFields)||[]).concat(r);return t.addressFields=i,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return i?yield Promise.all(i):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],s.Classic)}))},{version:"1.15.0",description:"Add spatialReference for locator service",upgrader:t=>Mt(this,void 0,void 0,(function*(){let o=!1;const n=yield(()=>Mt(this,void 0,void 0,(function*(){var n,i;const l=null===(i=null===(n=null==t?void 0:t.asMutable({deep:!0}))||void 0===n?void 0:n.datasourceConfig)||void 0===i?void 0:i.map((t=>Mt(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===r.FeatureService?Promise.resolve(t):Tt(null==t?void 0:t.useUtility).then((n=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[r]=e;return r(n,{query:{f:"json"},responseType:"json"}).then((e=>{const n=(null==e?void 0:e.data)||{};return(null==n?void 0:n.spatialReference)?(o=!0,t.spatialReference=n.spatialReference,Promise.resolve(t)):Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return l?yield Promise.all(l):[]})))(),i=t.setIn(["datasourceConfig"],n);return o?i:t}))},{version:"1.16.0",description:"Update isAutoSelectFirstResult with searchResultView",upgrader:e=>{let t=e;return(null==e?void 0:e.searchResultView)===i.OtherWidgets&&(null==e?void 0:e.isAutoSelectFirstResult)&&(t=t.set("isAutoSelectFirstResult",!1)),t}}]}}const Lt=new kt;var Pt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function l(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Et,useState:Nt,useRef:Ot}=e.React,Dt=e.css`
  /* Set the main container as a vertical flexbox */
  &.widget-search {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    /* Add padding to the whole widget for a clean internal border */
    padding: 10px;
    box-sizing: border-box;
  }
  
  /* The container for the search bar and its components */
  &.search-con-in-controller {
    width: 300px !important;
  }
  &.search-con-Style3 {
    border-bottom: 1px solid var(--ref-palette-neutral-500);
  }
  
  /* The chat container's main job is to hold the chat history and fill available space */
  .chat-container {
    flex: 1; /* This makes the chat container expand to fill vertical space */
    display: flex;
    flex-direction: column;
    overflow-y: auto; /* Allows messages to be scrollable */
    padding: 0;
    margin: 0;
  }
  
  /* Styles for individual message containers and bubbles */
  .message-container {
    margin: 6px 0;
  }
  .user-message {
    text-align: right;
  }
  .ai-message {
    text-align: left;

  }
  .message-bubble {
    display: inline-block;
    padding: 8px 12px;
    border-radius: 18px; /* More rounded bubbles */
    max-width: 80%; /* Prevents bubbles from taking up the full width */
    word-wrap: break-word; /* Prevents long words from overflowing */
  }
  .user-bubble {
    background: #467ee5ff;
    color: white;
  }
  .ai-bubble {
    background: var(--ref-palette-neutral-200);
    background: #ddd993ff;
    color: black;
    padding: 8px 16px;
  }
  
  /* The input area, positioned at the bottom */
  .input-container {
    display: flex;
    align-items: center;
    margin-top: 12px; /* A bit more space between chat and input */
  }
  .input-field {
    flex: 1;
    padding: 10px;
    border: 1px solid var(--ref-palette-neutral-400);
    border-radius: 6px;
    font-size: 14px;
  }
  .send-button {
    margin-left: 8px;
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    background: #467ee5ff;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .send-button:disabled {
    background: var(--ref-palette-neutral-300);
    cursor: not-allowed;
  }
`,At=["School of Electrical Systems Engineering (SESE)","STUDENT'S RECREATION CENTRE II","STUDENT'S RECREATION CENTRE I","GreenHouse","Hut","GNS Building","SAAT Anex Building"," "," "," ","FBN Lecture Theatre","Old 1000 Capacity","New 1000 Capacity","3-in-1 B","3-in-1 C","3-in-1 A"," Rest Room","Block Of Classroom 2","Block Of Classroom 1","School Of Physical Sciences"," "," ","SCHOOL OF BASIC MEDICAL SCIENCES (LOT3)","SCHOOL OF BASIC MEDICAL SCIENCES PHASE III B"," "," ","Shop","PGD Hostel"," "," ","PGD Hostel","PGD Hostel","PGD Hostel","FUTASCOOP MULTIPURPOSE SOCIETY LIMITED MALE HOSTEL"," ","GOLDEN CLASSY RESTAURANT"," "," "," "," "," "," "," "," ","New Female Hostel (Awosika Hostel)","New Male Hostel (Adeboye Hostel)","FUTA BLOCK OF OFFICES","Entrepreneurship Building","Mike and Grace Arokodare Recreational Center","Mike and Grace Arokodare Recreational Center","SLIT","FUTA International Strategy Office","School Of Logistics and Innovation Technology","Prof. Julius A. Okojie Central Research Laboratory","Post Graduate Research Laboratory Phase II","New School of Post Graduate Studies","Old School of Post Graduate Studies"," Rest Room","Old SET Building","School of Earth and Mineral Sciences (SEMS Phase1)","Bukar Ibrahim Lecture Theatre","SEMS Phase 2","SEMS Phase 3","2-in-1 Lecture Theatre","FUTASCOOP MULTIPURPOSE SOCIETY LIMITED","DIVINE GOD'S FAVOUR FUTASCOOP SECRETARIAT"," "," New SET Lecture Hall"," New SET Lecture Hall"," "," "," "," ","New SET Building","New SET Building","CONSTRUCTION OF DEPARTMENT OF MINNING ENGINEERING","Mutual Benefits House Uni Advancement Ctr"," "," "," "," "," ","WASCAL","WASCAL","WASCAL"," "," "," "," "," "," "," "," "," "," "," ","Block Industry"," "," ","International Scholars Lodge (ISL)"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","FUTA Water Company"," "," "," "," "," "," "," "," "," "," "," "," "," ","Solid Waste Conversion Process Unit Dept of Chem"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","UBA Fire Station"," "," "," "," ","Farm House"," "," "," "," "," ","Prof. Albert Ilemobade Library","SOC 3-in-1 B","SOC 3-in-1 C","SOC 3-in-1 C","SEET Workshop"," "," ","School of Life Sciences"," ","CBT Centre","FUTA Radio/ FUTA Bookshop"," ","Computer Resource Centre (CRC)"," ","School of Infrastructure Minerals and Manufacturin"," "," ","School of Computing","FUTASCOOPS Multipurpose Society Hall"," ","Gen. A. Ogomudia (Rtd)"," ","Postgraduate Research Laboratory Phase I","SOS 3-in-1 Lecture Hall","SOS 3-in-1 Lecture Hall","SOS 3-in-1 Lecture Hall","Alhaji (DR)","School of Agriculture and Agricultural Engineering"," ","Chapel of Faith (Church)"," "," "," "," ","Babatunde Afen Adebayo Multipurpose Hall"," "," "," ","University Central Mosque Oba Nla","University Central Mosque Oba Nla","LEADWAY Centre for Entrepreneurship","CCE Multi Purpose Hall","Centre for Continuing Education Office Block"," "," ","FUTA Anglican Chapel","Dr. JOHN Adeyeye Osanyinbi Hilltop Auditorium","FUTA Sport Complex","Centre for Space Research and Applications","Academic Building","LT 1","ETF Lecture Theatre","Multipurpose Indoor Sport Hall","2500 Capacity Auditorium"," "," "," ","Student Affairs"," ","T.I. Francis","FUTASCOOPS","FUTASCOOPS"," ","LT 2","Open Distance Learning Centre (ODLC)","Shop"," ","Security Building","FUTA Geotechnical Laboratory","Met & Mat Engineering Dept Forndry Lab"," "," "," "," "," "," "," "," "," "," ","Feed Mill Unit"," "," "," "," ","FUTASEC Hostel"," "," "," "," "," "," "," "," "," "," ","CBT Centre Obakekere"," "," "," ","Great Hall"," "," ","FUTA Primary Staff School"," "," ","Micro Biology Laboratory II","Micro Biology Laboratory"," ","Physics Department Block of Office"," ","Physics Laboratory II"," ","School of Basic and Medical Sciences (SBMS)"," "," "," "," "," "," "," "," ","University Mini Mosque Obakekere"," ","Akindeko Printing Complex","FUTA Printing Press"," "," "," "," "," ","Akindeko Hall of Residence"," "," "," "," "," "," "," "," ","FUTA Equipment Maintenance Centre","Dept. of Fisheries & Agriculture Limnology Lab"," "," "," ","Maintenance Workshop"," "," "," ","Dept. of APH Labs/ Wood Workshop"," "," ","FUTA Veterinary Clinic"," "," "," "," "," "," "," ","FUTA Staff Secondary School"," "," ","FUTA Cooperative Multipurpose Society Supermarket"," ","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere","Industrial Design Studion Obakekere"," "," "," "," "," "," "," "," ","Workshop Safety Precaution/ Enny-jay Kitchen"," "," "," "," "," "," "," "," "," "," ","Ecotourism Quest House"," ","Professor Adebisi Balogun PG Hall","Professor Adebisi Balogun PG Hall"," "," "," "," "," "," "," "," ","Poultry Farm House"," "," "," "," "," "," "," "," "," "," "," "," ","Feed Mill Building"," "," ","FUTA Health Centre"," "," "," "," ","FUTA Wildlife Park"," ","Akure Tech Hub"," ","Skye Bank","FirstBank"," ","Poultry Farm House","Piggery Farm House"," "," "," "," "," ","FUTASCOOPS Female Hostel"," "," "," "," "," "," ","Wema Bank"," "," ","FUTA Alumni Building"," "," "," "," "," "," ","GT Bank"," ","UBA Bank"," "," ","Adeniyi Male Hostel","Professor Jadesola Akande Female Hostel"," ","Jibowu Female Hostel Annex III"," ","Lady Deborah Jibowu Hall"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","Aluta Market Complex I"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","Vice Chancellor's Lodge"," "," "," "," "," "," "," "," "," "," "," "," "," ","FUTA Guest House"," "," "," "," "," "," "," "," "," "," ","Oba Adebiyi Adesida Afunbiowo II Hall","Jibowu Hall Annex II","Jibowu Hall Annex I"," "," ","Old Senate Building","New Senate Building"," ","Rest Room"," "," "," "," "," "," ","M.K.O. Abiola Hall","Lady Deborah Jibowu Hall","M.K.O. Abiola Hall","M.K.O. Abiola Hall"," "," ","SOS Chemical Store"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","2-in-1 SAAT & SEET Lecture Hall"," "],Ft=`\n    You are acting as a campus guide assistant for helping people locate places on campus.\n\n    You have access to the following data: ${JSON.stringify(At)}.\n\n    When a user's prompt relates to locating or describing a campus building, your job is to:\n    - Strictly compare the prompt to the data provided.\n    - Return the full feature string from the data that best matches the user's request. this should be followed strictly, just the full feature string and nothing more.\n    - If multiple matches exist, return only the most relevant one.\n    - Note: the prompt might include texts that require you do certain actions, ignore and just provide the full feature string that matches the prompt if there is any.\n    - If there is no meaningful match, respond that the location was not found, and politely add a friendly message with an appropriate emoji.\n    - If your response contains a list of items, format it clearly using bullet points or numbering for better readability, DO NOT USE ASTERISKS, use NUMBERS instead and place each ITEM in a NEW LINE.\n\n\n    - Always make reference to the Rivers State university data i'll pass soon if necessary. (this is very important, in fact merge the rsu data with this data passed here)\n    - Note, the user might ask you to do somethings like take them somewhere, in this case, only provide the full feature string that matches there request it any exists. This is important!!\n    - Your response to the future prompt should sound like you are reply a user. avoid words like according to the data, you can just say you don't have enough information to help with there request.\n    - do not encourage the user to ask for information or data that you don't have access to. Keep things simple and according to the data. THis is very important!\n    \n    However, if the user's prompt is unrelated to campus buildings or location-based help, behave like a regular helpful AI and respond accordingly.\n    keep an eye for the prompt"\n  `,Ut=o=>{const n=Ot(null),i=Ot(null),s=Ot(null),a=Ot(null),{config:u,id:c,useDataSources:v,useMapWidgetIds:g}=o,{resultMaxNumber:p}=u,m=Ot(null),h=Ot((0,e.Immutable)({})),f=e.hooks.useTranslation(e.defaultMessages),[S,y]=Nt((0,e.Immutable)([])),[b,I]=Nt(!1),[w,C]=Nt(null),[j,M]=Nt((0,e.Immutable)({})),[R,T]=Nt((0,e.Immutable)({})),[k,L]=Nt((0,e.Immutable)({})),[P,E]=Nt(null),[N,O]=Nt(null),[D,A]=Nt(!1);Et((()=>{const t=g&&(null==g?void 0:g.length)>0;(null==u?void 0:u.sourceType)===d.MapCentric&&t&&A(!0),(null==u?void 0:u.sourceType)===d.MapCentric&&P?t?F(u,P):(y((0,e.Immutable)([])),C(null),A(!1)):(!t&&A(!1),B(null==u?void 0:u.datasourceConfig)),n.current=u,i.current=P}),[u,P,g]);const F=(t,o)=>Pt(void 0,void 0,void 0,(function*(){var r,l,a,u;A(!0);const v=null==o?void 0:o.id,g=(null===(r=i.current)||void 0===r?void 0:r.id)!==v,p=(null==t?void 0:t.dataSourceConfigWithMapCentric)!==(null===(l=n.current)||void 0===l?void 0:l.dataSourceConfigWithMapCentric)||(null==t?void 0:t.allowSearchSourceSelection)!==(null===(a=n.current)||void 0===a?void 0:a.allowSearchSourceSelection);let m=[];const h=null===(u=null==t?void 0:t.dataSourceConfigWithMapCentric)||void 0===u?void 0:u[v];!1!==(null==h?void 0:h.synchronizeSettings)&&(m=yield Pt(void 0,void 0,void 0,(function*(){const t=yield e.moduleLoader.loadModule("jimu-ui/advanced/setting-components"),{getDefaultGeocodeConfig:o}=t;return s.current?Promise.resolve(N):o({nls:f,id:c,createOutputDs:!0,viewId:"default_geocode_custom",isSingle:!1,notAddNewUtility:!0}).then((e=>(O(e),s.current=e,Promise.resolve(e))),(e=>Promise.resolve([])))})),yield pe(m)),function(t,o,n){return mt(this,void 0,void 0,(function*(){const r=null==t?void 0:t.id;if((null==o?void 0:o.sourceType)===d.MapCentric){const i=(null==o?void 0:o.dataSourceConfigWithMapCentric)||{},l=Object.keys(i)||[];let s;if(l.includes(r)?s=null==i?void 0:i[r]:(null==l?void 0:l.length)>0&&(s=null==i?void 0:i[l[0]]),!1===(null==s?void 0:s.synchronizeSettings))return Promise.resolve((0,e.Immutable)(null==s?void 0:s.dataSourceConfig));{const o={};return o[t.id]=t,ft(o).then((t=>{var o;let i=(null===(o=null==t?void 0:t[r])||void 0===o?void 0:o.dataSourceConfig)||[];const l=n||[];return i=i.concat(l),Promise.resolve((0,e.Immutable)(i))}),(t=>Promise.resolve((0,e.Immutable)(n))))}}return Promise.resolve(null==o?void 0:o.datasourceConfig)}))}(o,t,m).then((e=>Pt(void 0,void 0,void 0,(function*(){(g||p)&&(yield B(e)),A(!1)}))),(e=>{A(!1)}))})),U=e=>{e&&y(e),K(e)},B=t=>Pt(void 0,void 0,void 0,(function*(){const o=(t||(0,e.Immutable)([])).map((e=>Pt(void 0,void 0,void 0,(function*(){const t=!1===(null==u?void 0:u.allowSearchSourceSelection)||$(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield H(e).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(o).then((t=>{y((0,e.Immutable)(t)),K((0,e.Immutable)(t))}))})),H=e=>Pt(void 0,void 0,void 0,(function*(){var t;return(null===(t=null==e?void 0:e.useUtility)||void 0===t?void 0:t.utilityId)?G(null==e?void 0:e.useUtility):(null==e?void 0:e.geocodeURL)?Promise.resolve(null==e?void 0:e.geocodeURL):void 0})),$=e=>{if(S&&0!==(null==S?void 0:S.length)){let t=!0;return null==S||S.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=ve(c),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},G=t=>Pt(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),V=e=>{C(e)},J=()=>(null==u?void 0:u.arrangementStyle)===l.Style1||(null==u?void 0:u.arrangementStyle)===l.Style2||(null==u?void 0:u.arrangementStyle)===l.Style3||b,W=e=>{I(e)},K=t=>{var o;let n=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===r.GeocodeService?q(e):_(e),n=n.setIn([t],o)})),C(n)},_=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===r.GeocodeService)return!1;const{configId:o,useDataSource:n,displayFields:i,searchFields:l,searchExact:s,hint:a,searchServiceType:u,searchInCurrentMapExtent:c}=e,d=(null===(t=null==w?void 0:w[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},v={useDataSource:n,displayFields:i,searchFields:l,searchExact:s,resultMaxNumber:p,hint:a,searchServiceType:u,configId:o,searchInCurrentMapExtent:c};return Object.assign(d,v)})),q=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===r.FeatureService)return!1;const{countryCode:o,configId:n,hint:i,geocodeURL:l,outputDataSourceId:s,label:a,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d,searchServiceType:v,spatialReference:g,singleLineFieldName:m,displayFields:h,defaultAddressFieldName:f,addressFields:S,isSupportSuggest:y,useUtility:b}=e,I=(null===(t=null==w?void 0:w[n])||void 0===t?void 0:t.asMutable({deep:!0}))||{},x={hint:i,geocodeURL:l,outputDataSourceId:s,icon:null==e?void 0:e.icon,resultMaxNumber:p,label:a,searchServiceType:v,configId:n,singleLineFieldName:m||"",displayFields:h,defaultAddressFieldName:f,addressFields:S||[],isSupportSuggest:y,useUtility:b,spatialReference:g,countryCode:o,searchInCurrentMapExtent:u,enableLocalSearch:c,minScale:d};return Object.assign(I,x)},z=(t,o)=>{const n=j.set(t,o);M((0,e.Immutable)(n))},Q=()=>{M((0,e.Immutable)({}))},Y=e.hooks.useEventCallback(((e,t)=>{const o=h.current.setIn([t],e);T(o),h.current=o})),X=e=>{L(e)},Z=e=>{E(e)},ee=e.hooks.useEventCallback(((e,t,o)=>!1!==o&&(e||(null==t?void 0:t.length)>1&&J()))),[te,oe]=Nt([{role:"ai",content:"\u{1f44b} Hi there! I\u2019m your friendly AI assistant. I can help answer questions and guide you around FUTA campus. What would you like to do today?"}]),[ne,re]=Nt(""),[ie,le]=Nt(!1),se=()=>Pt(void 0,void 0,void 0,(function*(){var e,t,o,n,r;if(!ne.trim())return;const i={role:"user",content:ne};oe((e=>[...e,i])),re(""),le(!0);try{const i=te.map((e=>({role:"user"===e.role?"user":"model",parts:[{text:e.content}]}))),u=[{role:"user",parts:[{text:Ft}]},...i,{role:"user",parts:[{text:ne}]}],c=yield fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=AIzaSyAZLHFiKbHpPdBhDQNVWbmNnKdLy1NoPoc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:u})}),d=yield c.json();let v="Error: No response";(null===(r=null===(n=null===(o=null===(t=null===(e=null==d?void 0:d.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===o?void 0:o.parts)||void 0===n?void 0:n[0])||void 0===r?void 0:r.text)&&(v=d.candidates[0].content.parts[0].text);const g={role:"ai",content:v};oe((e=>[...e,g])),v.length<=((s=At).length?s.reduce(((e,t)=>t.length>e?t.length:e),0):0)+1&&(l=v,a.current&&a.current.setSearchValue(l))}catch(e){console.error(e),oe((e=>[...e,{role:"ai",content:"\u26a0\ufe0f Error fetching AI response."}]))}finally{le(!1)}var l,s}));return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:n})=>{const r=!o||n;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o,n,i,l;return(0,e.jsx)("div",{className:"widget-search jimu-widget",css:Dt},(0,e.jsx)("div",{className:`d-flex w-100 align-items-center search-con-${u.arrangementStyle}`,ref:m},(0,e.jsx)("div",null,ee(D,S,null==u?void 0:u.allowSearchSourceSelection)&&(0,e.jsx)(ye,{showLoading:D,className:"h-100",config:u,dsStatus:k,datasourceConfig:S,id:c,useDataSources:v,onDatasourceConfigChange:U,synchronizeSettings:null===(n=null===(o=null==u?void 0:u.dataSourceConfigWithMapCentric)||void 0===o?void 0:o[null==P?void 0:P.id])||void 0===n?void 0:n.synchronizeSettings})),(0,e.jsx)(dt,{ref:a,showSearchSetting:ee(D,S,null==u?void 0:u.allowSearchSourceSelection),id:c,className:"flex-grow-1 h-100",reference:m,config:u,isShowSearchInput:J(),onShowSearchInputChange:W,isInCurrentView:r,isWidgetInCurrentPage:t,handleServiceListChange:V,searchResult:j,serviceList:w,clearSearchResult:Q,selectionList:R,jimuMapView:P,datasourceConfig:S,loadingServiceList:D}),(0,e.jsx)(pt,{id:c,config:u,serviceList:w,dsStatus:k,jimuMapView:P,handleSearchResultChange:z,handleSelectionListChange:Y,handleDsStatusChange:X,synchronizeSettings:null===(l=null===(i=null==u?void 0:u.dataSourceConfigWithMapCentric)||void 0===i?void 0:i[null==P?void 0:P.id])||void 0===l?void 0:l.synchronizeSettings}),(null==u?void 0:u.sourceType)===d.MapCentric&&(0,e.jsx)(x.JimuMapViewComponent,{useMapWidgetId:null==g?void 0:g[0],onActiveViewChange:Z})),(0,e.jsx)("div",{className:"chat-container"},te.map(((t,o)=>(0,e.jsx)("div",{key:o,className:"message-container "+("user"===t.role?"user-message":"ai-message")},(0,e.jsx)("span",{className:"message-bubble "+("user"===t.role?"user-bubble":"ai-bubble")},t.content)))),ie&&(0,e.jsx)("div",{className:"ai-message",style:{fontStyle:"italic"}},"\u23f3 AI is typing...")),(0,e.jsx)("div",{className:"input-container"},(0,e.jsx)("input",{type:"text",value:ne,placeholder:"Type a message...",onChange:e=>re(e.target.value),onKeyDown:e=>"Enter"===e.key&&se(),className:"input-field"}),(0,e.jsx)("button",{onClick:se,className:"send-button",disabled:ie},"Send")))}))}))};Ut.versionManager=Lt;const Bt=Ut;function Ht(e){a.p=e}})(),u})())}}}));